---
// components/QuizHabilitation.astro
// Supprimer l'import de React, on n'en a pas besoin dans Astro
---

<div id="quiz-container" class="quiz-container">
  <div class="quiz-header">
    <div class="quiz-progress">
      <div class="progress-bar"></div>
      <div class="progress-steps">
        <span class="step active">1</span>
        <span class="step">2</span>
        <span class="step">3</span>
      </div>
    </div>
    <h2 class="text-3xl font-bold text-gray-900 mb-2">
      ‚ö° Quelle habilitation √©lectrique vous faut-il ?
    </h2>
    <p class="text-gray-600">R√©pondez √† 3 questions pour obtenir une recommandation personnalis√©e</p>
  </div>

  <div id="quiz-content" class="quiz-content">
    <form id="quiz-form">
      <!-- Questions seront inject√©es par JavaScript -->
    </form>
    
    <div class="quiz-navigation">
      <button type="button" id="prev-btn" class="quiz-btn quiz-btn-secondary" disabled>
        ‚Üê Pr√©c√©dent
      </button>
      <button type="button" id="next-btn" class="quiz-btn quiz-btn-primary">
        Suivant ‚Üí
      </button>
    </div>
  </div>

  <div id="quiz-result" class="quiz-result hidden">
    <div class="result-card">
      <div class="result-icon">üéØ</div>
      <h3 class="result-title">Formation recommand√©e</h3>
      <div class="result-code" id="result-code">B1-B2-BR-BC</div>
      <p class="result-desc" id="result-desc">
        Formation compl√®te pour √©lectriciens : travaux, intervention, consignation en basse tension
      </p>
      <div class="result-actions">
        <a href="/formations" class="result-btn result-btn-secondary">
          üìö Voir le d√©tail
        </a>
        <a href="/contact" class="result-btn result-btn-primary">
          üìã Demander un devis
        </a>
      </div>
    </div>
  </div>

  <style>
    .quiz-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 24px;
      padding: 2rem;
      margin: 3rem 0;
      position: relative;
      overflow: hidden;
    }

    .quiz-container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent 30%,
        rgba(255,255,255,0.1) 50%,
        transparent 70%
      );
      animation: electricFlow 3s linear infinite;
    }

    @keyframes electricFlow {
      0% { transform: rotate(0deg) translate(-10%, -10%); }
      100% { transform: rotate(360deg) translate(-10%, -10%); }
    }

    .quiz-header {
      text-align: center;
      margin-bottom: 2rem;
      position: relative;
      z-index: 2;
    }

    .quiz-header h2 {
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .quiz-header p {
      color: rgba(255,255,255,0.9);
    }

    .quiz-progress {
      max-width: 400px;
      margin: 0 auto 2rem;
      position: relative;
    }

    .progress-bar {
      height: 4px;
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
      position: absolute;
      top: 12px;
      width: 100%;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      height: 100%;
      width: 0%;
      background: #4ade80;
      border-radius: 2px;
      transition: width 0.5s ease;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      position: relative;
    }

    .step {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .step.active {
      background: #4ade80;
      box-shadow: 0 0 0 4px rgba(74, 222, 128, 0.3);
    }

    .quiz-content {
      background: white;
      border-radius: 16px;
      padding: 2rem;
      position: relative;
      z-index: 2;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    .question {
      margin-bottom: 1.5rem;
    }

    .question-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 1rem;
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .option-btn {
      padding: 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      background: white;
      text-align: left;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .option-btn:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    }

    .option-btn.selected {
      border-color: #667eea;
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
    }

    .option-icon {
      font-size: 1.5rem;
    }

    .option-text {
      flex: 1;
      font-weight: 500;
      color: #374151;
    }

    .quiz-navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid #e5e7eb;
    }

    .quiz-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-size: 1rem;
    }

    .quiz-btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .quiz-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .quiz-btn-secondary {
      background: #f3f4f6;
      color: #4b5563;
    }

    .quiz-btn-secondary:hover {
      background: #e5e7eb;
    }

    .quiz-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .quiz-result {
      position: relative;
      z-index: 2;
      animation: slideUp 0.6s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .result-card {
      background: white;
      border-radius: 20px;
      padding: 2.5rem;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      border: 1px solid #e5e7eb;
    }

    .result-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      animation: bounce 1s ease infinite alternate;
    }

    @keyframes bounce {
      from { transform: translateY(0); }
      to { transform: translateY(-10px); }
    }

    .result-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.5rem;
    }

    .result-code {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 1rem 0;
    }

    .result-desc {
      color: #6b7280;
      font-size: 1.125rem;
      line-height: 1.6;
      margin-bottom: 2rem;
    }

    .result-actions {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .result-btn {
      padding: 0.875rem 1.75rem;
      border-radius: 12px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .result-btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .result-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    .result-btn-secondary {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }

    .result-btn-secondary:hover {
      background: #667eea;
      color: white;
    }

    .hidden {
      display: none;
    }

    @media (max-width: 768px) {
      .quiz-container {
        padding: 1.5rem;
        margin: 2rem 0;
      }
      
      .options-grid {
        grid-template-columns: 1fr;
      }
      
      .result-actions {
        flex-direction: column;
      }
      
      .quiz-navigation {
        flex-direction: column;
        gap: 1rem;
      }
    }
  </style>

  <script is:inline>
    // Donn√©es du quiz
    const quizData = {
      questions: [
        {
          id: 1,
          question: "Quelle est votre fonction principale ?",
          options: [
            { text: "Agent de nettoyage / Maintenance", value: "non-electricien", icon: "üßπ" },
            { text: "Technicien / √âlectricien", value: "electricien", icon: "‚ö°" },
            { text: "Chef d'√©quipe / Responsable", value: "responsable", icon: "üë®‚Äçüíº" },
            { text: "Ing√©nieur / Concepteur", value: "ingenieur", icon: "üìê" }
          ]
        },
        {
          id: 2,
          question: "Sur quel type d'installation intervenez-vous ?",
          options: [
            { text: "Basse tension uniquement", value: "bt", icon: "üîå" },
            { text: "Haute tension (HTA)", value: "ht", icon: "‚ö°" },
            { text: "Photovolta√Øque / Courant continu", value: "pv", icon: "‚òÄÔ∏è" },
            { text: "Mixte BT/HT", value: "mixte", icon: "üîÑ" }
          ]
        },
        {
          id: 3,
          question: "Quelle est votre activit√© principale ?",
          options: [
            { text: "Travaux hors tension", value: "travaux", icon: "üîß" },
            { text: "D√©pannage / Intervention", value: "depannage", icon: "üö®" },
            { text: "Man≈ìuvres d'exploitation", value: "manoeuvres", icon: "üéÆ" },
            { text: "Consignation", value: "consignation", icon: "üîí" }
          ]
        }
      ],
      formations: {
        "non-electricien_bt_travaux": {
          code: "B0-H0V",
          title: "Habilitation B0-H0V",
          description: "Ex√©cuter en s√©curit√© des op√©rations d'ordre non √©lectrique dans un environnement √† risque √©lectrique."
        },
        "non-electricien_pv_travaux": {
          code: "B0-H0V CC",
          title: "Habilitation B0-H0V Courant Continu",
          description: "Formation sp√©cifique pour les travaux en environnement courant continu."
        },
        "electricien_bt_travaux": {
          code: "B1-B2",
          title: "Habilitation B1-B2",
          description: "Travaux et direction de travaux en basse tension."
        },
        "electricien_bt_depannage": {
          code: "BR",
          title: "Habilitation BR",
          description: "Charg√© d'intervention g√©n√©rale en basse tension."
        },
        "electricien_bt_manoeuvres": {
          code: "BE Man≈ìuvre",
          title: "Habilitation BE Man≈ìuvre",
          description: "Man≈ìuvres d'exploitation en basse tension."
        },
        "electricien_bt_consignation": {
          code: "BC",
          title: "Habilitation BC",
          description: "Charg√© de consignation en basse tension."
        },
        "responsable_bt_travaux": {
          code: "B2V",
          title: "Habilitation B2V",
          description: "Charg√© de travaux au voisinage de pi√®ces nues sous tension."
        },
        "responsable_ht_travaux": {
          code: "BF-HF Chef",
          title: "Habilitation BF-HF (Chef)",
          description: "Chef de travaux sous tension en haute tension HTA."
        },
        "electricien_ht_travaux": {
          code: "BF-HF Ex√©cutant",
          title: "Habilitation BF-HF (Ex√©cutant)",
          description: "Travaux sous tension en haute tension HTA."
        },
        "electricien_pv_travaux": {
          code: "BP Photovolta√Øque",
          title: "Habilitation BP Photovolta√Øque",
          description: "Op√©rations sur installations photovolta√Øques."
        },
        "default": {
          code: "B1-B2-BR-BC",
          title: "Habilitation B1-B2-BR-BC",
          description: "Formation compl√®te pour √©lectriciens : travaux, intervention, consignation."
        }
      }
    };

    // Variables d'√©tat
    let currentStep = 0;
    const answers = {};

    // Fonctions du quiz
    function renderQuestion() {
      const question = quizData.questions[currentStep];
      const form = document.getElementById('quiz-form');
      
      if (!form) return;

      form.innerHTML = `
        <div class="question">
          <h3 class="question-title">${question.question}</h3>
          <div class="options-grid">
            ${question.options.map((option, index) => `
              <button type="button" 
                      class="option-btn ${answers[currentStep] === option.value ? 'selected' : ''}"
                      data-value="${option.value}"
                      data-index="${index}">
                <span class="option-icon">${option.icon}</span>
                <span class="option-text">${option.text}</span>
              </button>
            `).join('')}
          </div>
        </div>
      `;

      // Ajouter les gestionnaires d'√©v√©nements pour les options
      document.querySelectorAll('.option-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
          const value = this.getAttribute('data-value');
          answers[currentStep] = value;
          
          // Mettre √† jour l'UI
          document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
          
          // Activer le bouton suivant
          document.getElementById('next-btn').disabled = false;
        });
      });

      // Mettre √† jour les boutons
      document.getElementById('prev-btn').disabled = currentStep === 0;
      document.getElementById('next-btn').textContent = 
        currentStep === quizData.questions.length - 1 ? 'Voir le r√©sultat ‚Üí' : 'Suivant ‚Üí';
    }

    function setupEventListeners() {
      document.getElementById('next-btn').addEventListener('click', function() {
        if (currentStep < quizData.questions.length - 1) {
          currentStep++;
          renderQuestion();
          updateProgress();
        } else {
          showResult();
        }
      });

      document.getElementById('prev-btn').addEventListener('click', function() {
        if (currentStep > 0) {
          currentStep--;
          renderQuestion();
          updateProgress();
        }
      });
    }

    function updateProgress() {
      const progressBar = document.querySelector('.progress-bar');
      const steps = document.querySelectorAll('.step');
      
      if (progressBar) {
        const progress = ((currentStep + 1) / quizData.questions.length) * 100;
        progressBar.style.width = progress + '%';
      }
      
      steps.forEach(function(step, index) {
        if (index <= currentStep) {
          step.classList.add('active');
        } else {
          step.classList.remove('active');
        }
      });
    }

    function showResult() {
      // G√©n√©rer la cl√© bas√©e sur les r√©ponses
      let key = '';
      if (answers[0] && answers[1] && answers[2]) {
        key = answers[0] + '_' + answers[1] + '_' + answers[2];
      }
      
      const formation = quizData.formations[key] || quizData.formations.default;
      
      // Afficher le r√©sultat
      document.getElementById('quiz-content').classList.add('hidden');
      document.getElementById('quiz-result').classList.remove('hidden');
      
      document.getElementById('result-code').textContent = formation.code;
      document.getElementById('result-desc').textContent = formation.description;
      
      // Mettre √† jour les liens
      const formationLink = '/formations#' + formation.code.toLowerCase().replace(/\s+/g, '-');
      const detailBtn = document.querySelector('.result-btn-secondary');
      if (detailBtn) detailBtn.setAttribute('href', formationLink);
    }

    // Initialiser le quiz quand le DOM est charg√©
    document.addEventListener('DOMContentLoaded', function() {
      renderQuestion();
      setupEventListeners();
      updateProgress();
    });
  </script>
</div>